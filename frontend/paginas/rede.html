<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Noob Rede</title>
    <link rel="stylesheet" href="../componentes/styles.css">
</head>
<body>

<script src="../componentes/script-cabecalho.js"></script>
<header></header>

<main>
    <div class="colunas coluna1" id="colunas">
        <div class="blocos">
            <div>
                <div style="display: inline;">
                    <h2 style="display: inline;" id="nome-usuario-perfil">Fulano de Tal</h2> <span id="idade-usuario-perfil">(20 anos)</span></div>
                <div class="reduzido">
                    <div style="float: left; width: 50%"><p>Seguidores <b>514</b></p></div>
                    <div style="float: left; width: 50%"><p>Seguindo <b>309</b></p></div>
                </div>
            </div>
            <!--<div id="preview-container"><img id="preview-img" src="../imagens/perfis/foto.png" alt="Foto de perfil"></div>-->
            <img id="preview-img" src="../imagens/perfis/foto.png" alt="Foto de perfil" style="max-width: 100%; max-height: 200px;"><br>
            <div class="resumo">
                <p>Já esteve em: <b id="num-partidas">236</b><i> PARTIDAS</i></p>
                <div style="float: left; width: 50%;">
                    <p><i>Vitórias</i></p>
                    <p><b id="num-vitorias">137</b></p>
                </div>
                <div style="float: left; width: 50%;">
                    <p><i>Derrotas</i></p>
                    <p><b id="num-derrotas">137</b></p>
                </div>
            </div>
        </div>
         
        <button id="atualizacao-perfil" style="margin-top: 10px;">Atualizar perfil</button>
   
    </div>
    <div class="colunas coluna2rede" id="colunas">
        <div class="scrollable" id="contentContainerRede">
            <!-- Conteúdo gerado na rolagem infinita -->
        </div>
    </div>
    <div class="colunas coluna3" id="colunas">
        <div class="blocos">Espaço do jaba</div>
    </div>
</main>
<script>

function calcularIdade(dataNascimento) {
    const hoje = new Date();
    const nascimento = new Date(dataNascimento);
    let idade = hoje.getFullYear() - nascimento.getFullYear();
    const mes = hoje.getMonth() - nascimento.getMonth();
    if (mes < 0 || (mes === 0 && hoje.getDate() < nascimento.getDate())) {
        idade--;
    }
    return idade;
}

// Abre a tela de atualização de perfil ao clicar
document.getElementById('atualizacao-perfil').addEventListener('click', function() {
    window.location.href = 'alterar-perfil.html';
});

    document.addEventListener("DOMContentLoaded", async () => {
    const nome = localStorage.getItem('nome');
    const nascimento = localStorage.getItem('nascimento');
    const apelido = localStorage.getItem('apelido');
    const src = localStorage.getItem('src');
    
    // Atualizar o conteúdo dos elementos HTML
    if (nome) {
        document.getElementById('nome-usuario-perfil').textContent = nome;
    }
    if (nascimento) {
        const idade = calcularIdade(nascimento);
        document.getElementById('idade-usuario-perfil').textContent = `(${idade} anos)`;
    }
    // Verifica se o valor existe e define o atributo 'src' da imagem
    if (src) {
        document.getElementById('preview-img').src = src;
    }

    try {
        const response = await fetch('https://api-noob-1.onrender.com/api/atividades');
        const atividades = await response.json();

        let contador_partidas = 0;
        let contador_vitorias= 0;
        

        atividades.forEach(atividade => {
            // Contar ocorrências no array de usuários
            atividade.usuarios.forEach(usuario => {
                if (usuario.nome === apelido) {
                    contador_partidas++;
                }
            });

            // Contar ocorrências no array de vencedores
            atividade.vencedor.forEach(vencedor => {
                if (vencedor.nome === apelido) {
                    contador_vitorias++;
                }
            });
        });

        const derrotas = contador_partidas - contador_vitorias;

        document.getElementById('num-partidas').textContent = contador_partidas;
        document.getElementById('num-vitorias').textContent = contador_vitorias;
        document.getElementById('num-derrotas').textContent = derrotas;

        localStorage.setItem('partidas', contador_partidas);
        localStorage.setItem('vitorias', contador_vitorias);
        localStorage.setItem('derrotas', derrotas);

    } catch (error) {
        console.error('Erro ao buscar as avaliações:', error);
    }

});
</script>

<script src="../componentes/script-geral.js"></script>
<script src="../componentes/script-rede.js" type="module"></script>
<script src="../componentes/script-login.js"></script>
</body>
</html>